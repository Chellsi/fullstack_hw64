extends ../layout

block content
  .profile-container
    .profile-card
      .profile-header
        .user-avatar-profile
          span.avatar-text-profile= user.username.charAt(0).toUpperCase()
        h1.profile-title Вітаємо, #{user.username}!
        span.user-badge(class=user.role === 'admin' ? 'badge-admin' : 'badge-user')= user.role
      
      .profile-body
        .profile-section
          h3 Інформація про профіль
          .profile-row
            .profile-label ID:
            .profile-value= user.id
          .profile-row
            .profile-label Ім'я користувача:
            .profile-value= user.username
          .profile-row
            .profile-label Email:
            .profile-value= user.email
          .profile-row
            .profile-label Роль:
            .profile-value= user.role
        
        .profile-section
          h3 Налаштування
          .settings-grid
            .setting-card
              h4 🎨 Тема оформлення
              p Виберіть улюблену тему для сайту
              .theme-buttons
                button#lightThemeBtn.btn.btn-theme(class=theme === 'light' ? 'active' : '') 
                  | ☀️ Світла
                button#darkThemeBtn.btn.btn-theme(class=theme === 'dark' ? 'active' : '') 
                  | 🌙 Темна
              p#themeStatus.theme-status
      
      .profile-actions
        a.btn.btn-secondary(href='/') ← На головну
        button#logoutBtn.btn.btn-danger Вийти
  
  script.
    // Зміна теми
    document.getElementById('lightThemeBtn').addEventListener('click', async () => {
      await setTheme('light');
    });
    
    document.getElementById('darkThemeBtn').addEventListener('click', async () => {
      await setTheme('dark');
    });
    
    async function setTheme(theme) {
      try {
        const response = await fetch('/api/theme/set', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ theme })
        });
        
        const data = await response.json();
        
        if (data.success) {
          document.getElementById('themeStatus').textContent = `Тему змінено на "${theme}"`;
          document.getElementById('themeStatus').style.display = 'block';
          
          // Застосувати тему
          document.body.className = theme + '-theme';
          
          // Оновити активну кнопку
          document.querySelectorAll('.btn-theme').forEach(btn => {
            btn.classList.remove('active');
          });
          document.getElementById(theme + 'ThemeBtn').classList.add('active');
          
          setTimeout(() => {
            document.getElementById('themeStatus').style.display = 'none';
          }, 3000);
        }
      } catch (error) {
        console.error('Error setting theme:', error);
      }
    }
    
    // Вихід
    document.getElementById('logoutBtn').addEventListener('click', async () => {
      try {
        const response = await fetch('/auth/logout', {
          method: 'POST'
        });
        
        const data = await response.json();
        
        if (data.success) {
          window.location.href = '/auth/login';
        }
      } catch (error) {
        console.error('Logout error:', error);
      }
    });